var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var R=(e,t,s)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,_=(e,t)=>{for(var s in t||(t={}))te.call(t,s)&&R(e,s,t[s]);if(I)for(var s of I(t))se.call(t,s)&&R(e,s,t[s]);return e},k=(e,t)=>Z(e,ee(t));import{af as oe,A as ae,bP as ne,bO as ie,bQ as ue,bv as q,aS as W,an as re,r as m,a as le,bf as de,P as pe,_ as me,W as ce,a0 as l,B as g,a1 as P,a5 as r,w as p,aC as ge,D as L,H as T,ao as fe,ad as D,J as z,aa as be,F as H,G as N,ax as ve,$ as he,u as w}from"./vendor.67815207.js";import{a as Be,d as Fe,B as ye,u as Ce}from"./useForm.c04cc559.js";import{_ as Ve,af as je,h as _e}from"./index.87f2c6de.js";import{P as Pe}from"./index.e06e0165.js";/* empty css               */import{V as De,u as Ee}from"./VueMdEditor.177e9bb6.js";import{a as Ue,c as ke,u as Le}from"./post.1642b723.js";/* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css              *//* empty css                *//* empty css                */import"./index.877aa7e1.js";import"./index.01eba134.js";import"./useWindowSizeFn.e1e81155.js";import"./download.7d0575e0.js";import"./index.9377c3f0.js";/* empty css               *//* empty css               */import"./useContentViewHeight.57b32d2f.js";function G(e,t){Be(e,t),oe(()=>{Fe(e)})}const Te=[{field:"",component:"Upload",slot:"poster",label:"\u5C01\u9762",rules:[{required:!0}]},{field:"title",component:"Input",label:"\u6807\u9898",defaultValue:"",rules:[{required:!0}]},{field:"summary",component:"InputTextArea",label:"\u6458\u8981",defaultValue:"",rules:[{required:!0}]},{field:"",component:"Tag",slot:"tags",label:"\u6807\u7B7E",rules:[{required:!0}]},{field:"",component:"Input",slot:"markdown",label:"\u5185\u5BB9",rules:[{required:!0}]},{field:"",component:"Button",slot:"action",label:" "}],we=ae({components:{BasicForm:ye,CollapseContainer:je,PageWrapper:Pe,Upload:ne,PlusOutlined:ie,LoadingOutlined:ue,Tag:q,Button:W,Input:re,VueMdEditor:De},setup(){var $,x;G("Tag",q),G("Button",W);const{createMessage:e}=_e(),[t,{getFieldsValue:s,setFieldsValue:M}]=Ce(),A=m(!1),O=m(!1),y=le(),d=de(),h=m(""),E=o=>{const u=["image/jpeg","image/png","image/gif"].some(B=>B===o.type);u||e.error("\u4EC5\u652F\u6301\u683C\u5F0F\uFF1Ajpg,png,gif");const v=o.size/1024/1024<5;return v||e.error("\u56FE\u7247\u4E0D\u80FD\u5927\u4E8E5MB!"),u&&v},n=pe({fileList:[],posterUrl:"",posterLoading:!1,handleChange:()=>{},uploadPoster:({file:o})=>{!E(o)||(n.posterLoading=!0,setTimeout(()=>n.posterLoading=!1,5e3),Ee(o).then(({data:a})=>{n.posterLoading=!1,n.posterUrl=a.code===0?a.result.url:"",console.log(n.posterUrl),e.success(a.message)}))}}),f=m([]),b=m(""),c=m(!0),C=m(null),U=()=>{c.value=!c.value,c.value||he(()=>C.value.focus())},V=()=>{b.value.trim()!==""&&f.value.push(b.value),b.value="",c.value=!0},i=()=>{const o=`/post/itemPost/${d.params.id}`;Ue(o).then(a=>{const{result:u}=a;n.posterUrl=u.items.posterUrl,f.value=u.items.tags,h.value=u.items.content,M({title:u.items.title,summary:u.items.summary})})},J=(($=d.params)==null?void 0:$.id)?"\u4FDD\u5B58\u5E76\u66F4\u65B0":"\u53D1\u5E03";let Q=m(J);((x=d.params)==null?void 0:x.id)&&me(i);const S=()=>({title:"",summary:"",content:w(h),posterUrl:w(n.posterUrl),tags:w(f),lastModifiedDate:new Date,isPublic:!0}),K=o=>{var j;const{title:a,summary:u}=s(),v=o==="publish",B=k(_({},S()),{title:a,summary:u,isPublic:v});if((j=d.params)==null?void 0:j.id){updateAndPublish();return}ke(B).then(F=>{e.success(F.code===0?"\u53D1\u5E03\u6210\u529F":F.message),y.push({path:"/post/index"})})},X=o=>{const{title:a,summary:u}=s(),v=o==="publish",B=d.params.id,j=k(_({},S()),{_id:B,title:a,summary:u,isPublic:v});Le(j).then(F=>{e.success(F.code===0?"\u4FDD\u5B58\u6210\u529F":F.message),y.push({path:"/post/index"})})};return _({schemas:Te,postTags:f,tagVal:b,tagBtn:C,btnVisibility:c,addTag:V,toggleBtnVisibility:U,publishLoading:A,saveLoading:O,register:t,mdValue:h,btnText:Q,handleSave:o=>{var a;((a=d.params)==null?void 0:a.id)?X(o):K(o)}},ce(n))}}),Me=["src"],Ae={key:1},Oe=T("div",{class:"ant-upload-text"},"\u5C01\u9762\u4E0A\u4F20",-1),Se={class:"tag-container"},$e={class:"add-btn"},xe=D("\u6DFB\u52A0"),Ie=D("\u4FDD\u5B58\u81F3\u8349\u7A3F");function Re(e,t,s,M,A,O){const y=l("LoadingOutlined"),d=l("PlusOutlined"),h=l("Upload"),E=l("Tag"),n=l("Button"),f=l("Input"),b=l("VueMdEditor"),c=l("BasicForm"),C=l("CollapseContainer"),U=l("PageWrapper");return g(),P(U,null,{default:r(()=>[p(C,null,{default:r(()=>{var V;return[p(c,{title:"MarkDown\u8868\u5355",labelWidth:100,schemas:e.schemas,"show-submit-button":!1,"show-reset-button":!1,actionColOptions:{span:24},onRegister:e.register},ge({poster:r(()=>[p(h,{"file-list":e.fileList,"onUpdate:file-list":t[0]||(t[0]=i=>e.fileList=i),name:"avatar","list-type":"picture-card",class:"poster-uploader","show-upload-list":!1,action:"",customRequest:e.uploadPoster,onChange:e.handleChange},{default:r(()=>[e.posterUrl?(g(),L("img",{key:0,src:e.posterUrl,alt:"avatar"},null,8,Me)):(g(),L("div",Ae,[e.posterLoading?(g(),P(y,{key:0})):(g(),P(d,{key:1})),Oe]))]),_:1},8,["file-list","customRequest","onChange"])]),tags:r(({})=>[T("div",Se,[(g(!0),L(be,null,fe(e.postTags,i=>(g(),P(E,{closable:"",key:i,color:"pink"},{default:r(()=>[D(z(i),1)]),_:2},1024))),128)),T("div",$e,[H(p(n,{size:"small",onClick:ve(e.toggleBtnVisibility,["stop"])},{default:r(()=>[p(d),xe]),_:1},8,["onClick"]),[[N,e.btnVisibility]]),H(p(f,{ref:"tagBtn",class:"post-form-input",value:e.tagVal,"onUpdate:value":t[1]||(t[1]=i=>e.tagVal=i),size:"small",onPressEnter:e.addTag,onBlur:e.addTag},null,8,["value","onPressEnter","onBlur"]),[[N,!e.btnVisibility]])])])]),action:r(({})=>[p(n,{loading:e.publishLoading,class:"mr-2",type:"primary",onClick:t[3]||(t[3]=i=>e.handleSave("publish"))},{default:r(()=>[D(z(e.btnText),1)]),_:1},8,["loading"]),p(n,{loading:e.saveLoading,onClick:t[4]||(t[4]=i=>e.handleSave("draft"))},{default:r(()=>[Ie]),_:1},8,["loading"])]),_:2},[e.mdValue||!((V=e.$route.params)==null?void 0:V.id)?{name:"markdown",fn:r(({})=>[p(b,{value:e.mdValue,"onUpdate:value":t[2]||(t[2]=i=>e.mdValue=i)},null,8,["value"])])}:void 0]),1032,["schemas","onRegister"])]}),_:1})]),_:1})}var mt=Ve(we,[["render",Re]]);export{mt as default};
